/*
 +^^^^^^^^^^^^^^^^^^^^^^                                                                                                   +^^^^^^^^^^^;                                :^^^^^^^^^^^^         +^^^^^^^^^^^^^^^^^^^%?^^^^^^^^^%%^^^^^^^^^^;                                         
 S@@@@@@@@@@@@@@@@@@@@@@                                                                                                   S@@@@@@@@@@@%                                +@@@@@@@@@@@@.        S@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%                                         
 S@@@%;;;;;;;;;;;;;;;;S@                                                                                                   S#;;;;;;;;;@%                                +@+;;;;;;;;S@         S#;;;;;;;;;;;;;;;;;+@#;;;;;;;;;@#;;;;;;;;;@%                                         
 S@@?,,,,,,,,,,,,,,,,,%@                                                                                                   S#,,,,,,,,,@%                                +@:,,,,,,,,%@.        S#,,,,,,,,,,,,,,,,,:@#,,,,,,,,,@#,,,,,,,,,@%                                         
 S@%,,,,,,,,,,,,,,,,,,%@::::::::::::::::::+;:::::::::::::::::::++::::::::::::::::::+;::::::::::::::::::+;::::::::::::::::::##,,,,,,,,,@S::++::::::::::::::::::+;::::::::?@:,,,,,,,,%@         S#,,,,,,,,,,,,,,,,,:@@?????????@#,,,,,,,,,@S:::::::::::::::::::,                     
 S#,,,,,,,,,,,,,,,,,,,@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#,,,,,,,,,@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@:,,,,,,,,%@.        S#,,,,,,,,,,,,,,,,,:@@@@@@@@@@@@#,,,,,,,,,@@@@@@@@@@@@@@@@@@@@@^                     
 S#,,,,,,,,,,,,,,,,,,,@@@@%;;;;;;;;;;;+#@@@#;;;;;;;;;;;;;;;;?@@@@@@%;;;;;;;;;;;+#@@@#;;;;;;;#@@@^;;;;;+@#;;;;;;;;;;;;;;+#@@@#,,,,,,,,,;;;;@@@@%;;;;;;;;;;;+#@@@@@@%;;;;;;;,,,,,,,,,%@         S#,,,,,,,,,,,,,,,,,:@#,,,,,,,,,@#,,,,,,,,,@@@@%;;;;;;;;;;;+#@@@^                     
 S#,,,,,,,,,,,,,,,,,,,@@@%,,,,,,,,,,,,,:#@@#,,,,,,,,,,,,,,,,,^@@@@%,,,,,,,,,,,,,:#@@#,,,,,,,^@@#,,,,,,:@#,,,,,,,,,,,,,,,:#@@#,,,,,,,,,,,,,#@@%,,,,,,,,,,,,,:#@@@@?,,,,,,,,,,,,,,,,,%@         S#,,,,,,,,,,,,,,,,,:@#,,,,,,,,,@#,,,,,,,,,@@@%,,,,,,,,,,,,,:#@@^                     
 S#:::::::::::::::::::@@%::::::::::::::::#@#::::::::::::::::::?@@%::::::::::::::::#@#::::::::#@+::::::;@#:::::::::::::::::#@#:::::::::::::#@%::::::::::::::::#@@%::::::::::::::::::%@         S#:::::::::::??????%@#:::::::::@#:::::::::@@%::::::::::::::::#@^                     
 S#:::::::::::::::::::@#:::::::::::::::::;@#:::::::::::::::::::@#:::::::::::::::::;@#::::::::^S:::::::;@#:::::::::::::::::;@#:::::::::::::@#:::::::::::::::::;@#:::::::::::::::::::%@         S#:::::::::::@@@@@@@@#:::::::::@#:::::::::@#:::::::::::::::::;@^                     
 S#:::::::::S@@@@@@@@@@#:::::::::::::::::;@#:::::::::::::::::::@#:::::::::::::::::;@#:::::::::;:::::::;@#:::::::;:::::::::;@#:::::::::::::@#:::::::::::::::::;@#:::::::::::::::::::%@         S#:::::::::::++++++^@#:::::::::@#:::::::::@#:::::::::::::::::;@^                     
 S#;;;;;;;;;S@%%%%%%%%@#;;;;;;%####?;;;;;+@#;;;;;;;;;;;;;;;;;;;@#;;;;;;%####?;;;;;+@#;;;;;;;;;;;;;;;;;+@#;^?%S##@;;;;;;;;;;@#;;;;;;;;;;;;;@#;;;;;;%####?;;;;;+@#;;;;;;;;;^;;;;;;;;;%@         S#;;;;;;;;;;;;;;;;;+@#;;;;;;;;;@#;;;;;;;;;@#;;;;;;%####?;;;;;+@^                     
 S#;;;;;;;;;S#;;;;;;;;@#;;;;;;%####?;;;;;+@#;;;;;;;;;;;;;;;;;;;@#;;;;;;%####?;;;;;+@#;;;;;;;;;;;;;;;;;+@@@@@@@#S%;;;;;;;;;+@#;;;;;;;;;;;;;@#;;;;;;%####?;;;;;+@#;;;;;;;;+@?;;;;;;;;%@         S#;;;;;;;;;;;;;;;;;+@#;;;;;;;;;@#;;;;;;;;;@#;;;;;;%####?;;;;;+@^                     
 S#;;;;;;;;;S#;;;;;;;;@#;;;;;;;;;;;;;;;;;+@#;;;;;;;;;^+;;;;;;;;@#;;;;;;;;;;;;;;;;;+@#;;;;;;;;;;;;;;;;;+@@%%^+;;;;;;;;;;;;;+@#;;;;;;;;?@@@@@#;;;;;;;;;;;;;;;;;+@#;;;;;;;;^@?;;;;;;;;S@         S#;;;;;;;;;;;;;;;;;+@#;;;;;;;;;@#;;;;;;;;;@#;;;;;;;;;;;;;;;;;+@^                     
 S#;;;;;;;;;S#;;;;;;;;@#;;;;;;;;;;;;;;;;;+@#;;;;;;;;^@?;;;;;;;;@#;;;;;;;;;;;;;;;;;+@#;;;;;;;;;;;;;;;;;+@#;;;;;;;;;;;;;;;;;+@#;;;;;;;;?####@#;;;;;;;;;;;;;;;;;+@#;;;;;;;;^@?;;;;;;;;S@         S#;;;;;;;;;;;;;;;;;+@#;;;;;;;;;@#;;;;;;;;;@#;;;;;;;;;;;;;;;;;+@^                     
 S#+++++++++S#++++++++@#++++++++++++++^^?%@#++++++++^@?++++++++@#++++++++++++++^^?%@#++++++++++++++++++@#++++++++++++++++++@#+++++++++++++@#++++++++++++++^^?%@#++++++++^@?++++++++S@         S#++++++++++++++++++@#+++++++++@#+++++++++@#++++++++++++++^^?%@^                     
 S#+++++++++++++++++++@#+++++++++^%#@@@@@@@#++++++++^@?++++++++@#+++++++++^%#@@@@@@@#+++++++++^^^^^^^^?@#++++++#@@@@%+++++^@#+++++++++++++@#+++++++++^%#@@@@@@@#++++++++^@?++++++++S@         S#+++++++++^^^^^^^^?@#+++++++++@#+++++++++@#+++++++++^%#@@@@@@@^                     
 S#+++++++++++++++++++@#+++++++++^@@#S?^^+@#++++++++^@?++++++++@#+++++++++^@@#S?^^+@#+++++++++@@@@@@@@@@#++++++%####?++++++@#+++++++++++++@#+++++++++^@@#S?^^+@#+++++++++++++++++++S@         S#+++++++++@@@@@@@@@@#+++++++++@#+++++++++@#+++++++++^@@#S?^^+@^                     
 S#+++++++++++++++++++@#++++++++++++++++++@#++++++++^@?++++++++@#++++++++++++++++++@#+++++++++@@@@@@@@@@#++++++++++++++++++@#+++++++++++++@#++++++++++++++++++@#+++++++++++++++++++S@         S#+++++++++@@@@@@@@@@#+++++++++@#+++++++++@#++++++++++++++++++@^                     
 S@^;;;;;;;;;;;;;;;;;;@@^;;;;;;;;;;;;;;;;+@#;;;;;;;;^@?;;;;;;;;@@^;;;;;;;;;;;;;;;;+@#;;;;;;;;;@@@@@@@@@@@^;;;;;;;;;;;;;;;;+@@^;;;;;;;;;;;;@@^;;;;;;;;;;;;;;;;+@@^;;;;;;;;;;;;;;;;;;S@         S#;;;;;;;;;@@@@@@@@@@#;;;;;;;;;@@^;;;;;;;;@@^;;;;;;;;;;;;;;;;+@^                     
 S@@+;;;;;;;;;;;;;;;;;@@#+;;;;;;;;;;;;;;;+@#;;;;;;;;^@?;;;;;;;;@@#+;;;;;;;;;;;;;;;+@#;;;;;;;;;@@@@@@@@@@@#+;;;;;;;;;;;;;;;+@@@+;;;;;;;;;;;@@#+;;;;;;;;;;;;;;;+@@@+;;;;;;;;;;;;;;;;;S@         S#;;;;;;;;;@@@@@@@@@@#;;;;;;;;;@@@+;;;;;;;@@#+;;;;;;;;;;;;;;;+@^                     
 S@@@+;;;;;;;;;;;;;;;;@@@@+;;;;;;;;;;;;;;+@#;;;;;;;;^@?;;;;;;;;@@@@+;;;;;;;;;;;;;;+@#;;;;;;;;;@@@@@@@@@@@@@+;;;;;;;;;;;;;;+@@@@+;;;;;;;;;;@@@@+;;;;;;;;;;;;;;+@@@@+;;;;;;;;;;;;;;;;S@         S#;;;;;;;;;@@@@@@@@@@#;;;;;;;;;@@@@+;;;;;;@@@@+;;;;;;;;;;;;;;+@^                     
 S@@@@%%%%%%%%%%%%%%%%@@@@@%%%%%%%%%%%%%%%@@%%%%%%%%S@S%%%%%%%%@@@@@%%%%%%%%%%%%%%%@@%%%%%%%%%@@@@@@@@@@@@@@%%%%%%%%%%%%%%%@@@@@%%%%%%%%%%@@@@@%%%%%%%%%%%%%%%@@@@@%%%%%%%%%%%%%%%%#@         S@%%%%%%%%%@@@@@@@@@@@%%%%%%%%%@@@@@%%%%%%@@@@@%%%%%%%%%%%%%%%@^                     
 #@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@         #@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@?                     
 S@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@         S@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@^                     
 S@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@         S@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@^                     
 S@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#SS#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#SS#@@@@@@@@@@@@@@@@#SS#@@@@@@@@@@@@@@@@#SS#@@@@@@@@@@@@@#@@@@@@@@@@@@@@@@@#SS#@@@@@@@@@@@@@@@@@@@@S^         S@@@@@@@@@@@@@@@@#SS#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#SS^,                     
 S@@@@@@@@@@@@@@@@@#^.S@@@@@@@@@@@@S?+.   S@@@@@@@@@@@@@@@@@#^.S@@@@@@@@@@@@S?+.   S@@@@@@@@@@@@S?+.   S@@@@@@@@@@@@S?+.   S@@@@@@@@@#?+, S@@@@@@@@@@@@S?+.   S@@@@@@@@@@@@@@@@@#^.           S@@@@@@@@@@@@S?+.   S@@@@@@@#+.S@@@@@@@#+.S@@@@@@@@@@@@S?+.                          
 S@@@@@@@@@@@@@@@S;.  S@@@@@@@@S^;.       S@@@@@@@@@@@@@@@S;.  S@@@@@@@@S^;.       S@@@@@@@@S^;.       S@@@@@@@@S^;.       S@@@@@@S^,     S@@@@@@@@S^;.       S@@@@@@@@@@@@@@@S;.             S@@@@@@@@S^;.       S@@@@#?;   S@@@@#?;   S@@@@@@@@S^;.                              
 +^^^^^^^^^^^^^^:.    +^^^^^^:.           +^^^^^^^^^^^^^^:.    +^^^^^^:.           +^^^^^^:.           +^^^^^^:.           +^^^^:.        +^^^^^^:.           +^^^^^^^^^^^^^^:.               +^^^^^^:.           +^^^,      +^^^,      +^^^^^^:.                                  
 */
using Microsoft.AspNetCore.Mvc;

namespace CSharpControllers.Output.Controllers {
  [Route("api/v1/Widgets"), ApiController]
  public class Widgets : Controller {
    private readonly EntityDbContext _db;

    public Widgets(EntityDbContext db) {
      _db = db;
    }


    [HttpPost()]
    public IActionResult<Widget> Post([FromBody] Widget widget) {
      Widget dbWidget = new Widget();
      dbWidget.Id = Guid.NewGuid();
      dbWidget.Name = widget.Name;
      dbWidget.Description = widget.Description;
      _db.Add(dbWidget);
      _db.SaveChanges();
      return Ok(dbWidget);
    }

    [HttpPut()]
    public IActionResult<Widget> Put([FromBody] Widget widget) {
      var dbWidget = _db.Widgets.Single(x => x.Id.Equals(widget.Id));
      dbWidget.Name = widget.Name;
      dbWidget.Description = widget.Description;
      _db.Update(dbWidget);
      _db.SaveChanges();
      return Ok(dbWidget);
    }

    [HttpGet("/:id")]
    public IActionResult<List<Widget>> GetAll([FromRoute] Guid id) {
      return Ok(_db.Widgets.Single(x => x.Id.Equals(id)));
    }

    [HttpDelete()]
    public IActionResult<Widget> Delete([FromBody] Widget widget) {
      var dbWidget = _db.Widgets.Single(x => x.Id.Equals(widget.Id));
      dbWidget.DeletedAt = DateTime.Now;
      _db.Add(dbWidget);
      _db.SaveChanges();
      return Ok(dbWidget);
    }

  }
}